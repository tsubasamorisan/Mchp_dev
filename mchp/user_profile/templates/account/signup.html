{% extends "account/base.html" %}

{% load i18n %}
{% load account %}
{% load socialaccount %}

{% block head_title %}{% trans "Signup" %}{% endblock %}

{% block extra_head %}
	{% load staticfiles %}
	<link rel="stylesheet" type="text/css" href="{% static 'user_profile/css/form.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'user_profile/css/validator.css' %}">
	<script src="{% static 'user_profile/js/form.js' %}"></script>
	<script src="{% static 'user_profile/js/bootstrapValidator.min.js' %}"></script>
{% endblock %}

{% block content %}
<div class="container">
    <h2 class="text-center">Got Credentials?</h2>

    <p><img class="media-object img-responsive center-block" src=
    "https://s3-us-west-2.amazonaws.com/mchpstatic/Flat+Icon+SVG/SVG/support.svg" alt=
    "..."></p>
<div class="form-signin">
<div class='facebookSignup'>
	<p class="text-center">Finish signing up:</p>
	<div class="socialaccount_ballot">
		<a title="Facebook" class="socialaccount_provider facebook" 
			href="javascript:allauth.facebook.login('', 'authenticate',
			'login')">
			<button class="btn btn-facebook btn-block btn-primary btn-login form-control">
				Use Facebook
		</button></a>
		{% include "socialaccount/snippets/login_extra.html" %}
	</div>
	<hr>
	<span class="help-block text-center"><a id='show-signUp'>Use your own</a></span>
</div>

<div class="email_reminder">
	<strong class="text-center">
		Using your E-mail:</strong> {{ request.session.initial_email }}
		<small class="text-danger"><a class="text-danger" href="/"> {% trans "(edit)" %}</a></small>
</div>
<form class="emailSignup" id="signup_form" method="post" action="{% url 'account_signup' %}">
  {% csrf_token %}
  {{ form.as_p }}
  <input type="hidden" name="saved_email" value="{{ request.session.initial_email }}" />
  {% if redirect_field_value %}
  <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
  {% endif %} 
  <div class="form-group">
  <button type="submit" class="btn btn-lg btn-primary btn-block"><i class="fa fa-check-square-o"></i> {% trans "Sign Up" %}</button>
  </div>
</form>
</div>
</div>
<!--<p>{% blocktrans %}Already have an account? Then please <a href="{{ login_url }}">sign in</a>.{% endblocktrans %}</p>-->

{% endblock %}
{% block extra_body %}
    <script>
    // hide unwanted labels
    $('label').hide();
   
    // style error message to BS Validator
    var html = [],
        $list = $('.errorlist');

    html.push('<div class="errorlist">');
        $list.find('li').each(function() {
        html.push('<p class="text-danger small">' + $(this).text() + '</p>');
        });
    html.push('</div>');
    $list.replaceWith(html.join(''));

    // Convert form to BS Validator
    $("#id_first_name").wrap( $( "<div class='form-group'><div class='input-group'></div></div>" ) );
    $("#id_first_name").before( "<span class='input-group-addon glyphicon glyphicon-user'></span>" );
    $("#id_first_name").addClass("form-control input-lg");

    $("#id_last_name").wrap( $( "<div class='form-group'><div class='input-group'></div></div>" ) );
    $("#id_last_name").before( "<span class='input-group-addon glyphicon glyphicon-user'></span>" );
    $("#id_last_name").addClass("form-control input-lg");

    $("#id_username").wrap( $( "<div class='form-group'><div class='input-group'></div></div>" ) );
    $("#id_username").before( "<span class='input-group-addon glyphicon glyphicon-user'></span>" );
    $("#id_username").addClass("form-control input-lg");

    $("#id_password1").wrap( $( "<div class='form-group'><div class='input-group'></div></div>" ) );
    $("#id_password1").before( "<span class='input-group-addon glyphicon glyphicon-lock'></span>" );
    $("#id_password1").addClass("form-control input-lg");

    $("#id_password2").wrap( $( "<div class='form-group'><div class='input-group'></div></div>" ) );
    $("#id_password2").before( "<span class='input-group-addon glyphicon glyphicon-lock'></span>" );
    $("#id_password2").addClass("form-control input-lg");

    // BS Validator 
    $('#signup_form').bootstrapValidator({
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            username: {
                trigger: 'keyup',
                validators: {
                    notEmpty: {
                        message: 'This field is required'
                    },
                    stringLength: {
                        min: 4,
                        message: 'Your username or email must be more than 4 characters'
                    }
                }
            },
            password1: {
                trigger: 'keyup',
                validators: {
                    notEmpty: {
                        message: 'This field is required'
                    },
                    stringLength: {
                        min: 8,
                        message: 'Your password must be at least 8 characters'
                    },
                    identical: {
                        field: 'password2',
                        message: 'Your password must match the one below'
                    }
                }
            },
            password2: {
                trigger: 'keyup',
                validators: {
                    notEmpty: {
                        message: 'This field is required'
                    },
                    identical: {
                        field: 'password1',
                        message: 'Your password must match the one above'
                    }
                }
            }
        }
    });
    </script>
{% endblock %}
