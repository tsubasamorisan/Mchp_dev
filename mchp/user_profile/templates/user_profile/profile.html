{% extends 'user_profile/base.html' %}

{% block head_title %}
{% if request.user.is_authenticated %}
{{student.name}}
{% else %}Not Logged In
{% endif %}
{% endblock %}
{% block extra_head %}

<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/inputs-ext/typeaheadjs/typeaheadjs.js"></script>
<!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.4/dist/typeahead.bundle.min.js"></script> -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.9.3/typeahead.min.js"></script>


{% load staticfiles %}
<script src="{% static 'lib/js/jquery.cookie.js' %}"></script>
<!-- <script src="{% static 'lib/js/bootstrap3-typeahead.min.js' %}"></script> -->
<!-- <link rel="stylesheet" type="text/css" href="{% static 'documents/css/list.css' %}"> -->
<link rel="stylesheet" type="text/css" href="{% static 'user_profile/css/user_profile.css' %}">
<script src="{% static 'user_profile/js/profile.js' %}"></script>
<!-- // <script src="{% static 'documents/js/list.js' %}"></script> -->

{% endblock %}

{% block body %}
{% load humanize %}
<div class="container">
	<span class="text-center center-block">
		<img src="{{profile.profile_image_url}}" style="height: 160px; width: 160px;" id="profile-image" class="profile-image animated flipInX img-thumbnail img-circle delayed-sm">
		{% ifequal viewer student %}
		<div id="update-photo">
			<form method="post" action="{% url "edit_pic" %}" id="pic-form">
				{% csrf_token %}
				<div class="btn-file">
					<span class=""><i class="fa fa-camera"></i> Update <input name="pic" id="pic-input" type="file">
					</span>
				</div>
			</form>
		</div>
		{% endifequal %}
		<h2 style="margin-bottom:;">{{student.name}}</h2>
		<p class="small">
			{% ifequal viewer student %}<i class="fa fa-graduation-cap fa-fw"></i> 
			<a href="#" data-type="typeaheadjs" id="major" data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"> {% if student.major %}{{student.major}}{% endif %} Major</a>
			{% else %}
			<span id="major-other"><i class="fa fa-graduation-cap fa-fw"></i> {% if student.major %}{{student.major}}{% endif %} Major</span> &nbsp;
			{% endifequal %}
			<i class="fa fa-university fa-fw"></i><a href="{% url "school" student.school.pk %}">{{student.school.name}}</p></a>
		<div class="about-container">
			{% ifequal viewer student %}
			<p class="lead" id="about" data-type="text" data-title="blurb"
				data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}">{{profile.blurb}}</p> 
			{% else %}
			<p class="lead" id="about-other">{{profile.blurb}}</p> 
			{% endifequal %}
		</div>
		<p></p>
		<div class="progress">
			<div class="progress-bar progress-bar-primary" data-toggle="tooltip" data-original-title="Documents" data-placement="bottom" style="width: {{doc_percent}}%;">
				<span class="sr-only">Documents</span>
			</div>
			<div class="progress-bar progress-bar-warning" data-toggle="tooltip" data-original-title="Calendars" data-placement="bottom" style="width: {{cal_percent}}%;">
				<span class="sr-only">Calendars</span>
			</div>
		</div>

		<div class="well">

			<div id="user_classes">
				<div class="panel panel-default text-center">
					<div class="panel-body">
						<div class="page-header">
							<h3 class="text-center">
								{% ifequal viewer student %}
								Classes
								{% else %}
								{{student.username}}'s Classes
								{% endifequal %}
							</h3>
							{% ifequal viewer student %}
							{% else %}
							<p class="text-center">You have 2 classes in common</p>
							{% endifequal %}
						</div>
						<div class="row">
							{% for course in student.courses.all %}
							<div class="col-sm-2 col-centered">
								<p></p>
								<!-- don't include the slug here -->
								<a href="{%url "course" course.pk%}">
									<img src="https://s3-us-west-2.amazonaws.com/mchpstatic/Flat+Icon+SVG/SVG/book.svg" width="75px" alt="classes">
								</a>
								<i class="fa fa-check-circle-o fa-2x class-in-common"></i>
								<div class="caption">
									<h5>{{course}} <br> Instructor {{course.professor}}</h5>
									<p class="small"><i class="fa fa-users fa-fw"></i> {{course.student_count}} <i class="fa
											fa-calendar fa-fw"></i> {{course.calendar_count}} <i class="fa fa-file fa-fw"></i>
										{{course.document_count}}</p>
								</div>
							</div>
							{% empty %}
							{% ifequal viewer student %}
							<p class="lead text-center">You haven't added any classes yet, but it's never to late!</p>
							<p class="text-center"><a href="{% url 'course_add'%}" class="btn btn-primary">Add Classes</a></p>
							{% else %}
							<p class="lead text-center">{{student.first_name}} isn't enrolled in any classes</p>
							{% endifequal %}
							<hr>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>

			<div class="panel panel-default">
				<div class="panel-body">
					<div class="page-header">
						<h3 class="text-center">Documents</h3>
						<p class="text-center"><span class="badge">{{upload_list|length}}</span></p>
					</div>

					{% if upload_list %}
					<div class="list-group" id="document-list">
						{% for document in upload_list %}
						<li class="list-group-item" id="document_{{document.pk}}">

							<div class="media">
								<div class="img-thumbnail pull-left">
									<a href="{% url 'document_list' %}
										{{ document.uuid}}/
										{{ document.slug}} ">

										{% if document.preview %}
										<img src="{{document.preview.url}}" style="width:64px">
										{% else %}
										<img src="{% static 'documents/img/loading_file.svg' %}" style="width:64px">
										{% endif %}
									</a>
								</div>

								<div class="media-body">
									<h4 class="media-heading"><a href="{% url 'document_list' %}
											{{ document.uuid}}/
											{{ document.slug}}
											">{{ document.title }}</a> <small>{{document.price}} points</small>
										<div class="pull-right small text-muted">{{document.create_date | naturaltime}}</div>
									</h4>
									<span class="description">
										<i class="fa fa-fw fa-thumbs-o-up text-success"></i>{{document.up}}
										<i class="fa fa-fw fa-thumbs-o-down text-danger fa-flip-horizontal"></i>{{ document.down}}&nbsp;&nbsp;
										<i class="fa fa-comments-o text-info fa-fw"></i>&nbsp;{{document.review_count}} Reviews&nbsp;&nbsp;
										<i class="fa fa-fw fa-money text-success"></i>&nbsp;{{document.purchase_count}} Purchases
										<p class="small margin-top-sm">in 
											<a href="{%url "course" document.course.pk%}{{document.course.name}}">{{document.course.dept}} {{document.course.course_number}}</a>
										</p>
									</span>
								</div>
							</div>
						</li>
						{% endfor %}
					</div>
				</div>
				<div id="no-documents" style="display: none;">
					<p class="lead text-center">{{student.user.username}} isn't selling any documents!</p>
					<hr>
				</div>
				{% else %}
				<div id="no-documents">
					<p class="lead text-center">{{student.user.username}} isn't selling any documents!</p>
					<hr>
				</div>
				{% endif %}
			</div>

			<div class="panel panel-default">
				<div class="panel-body">
					<div class="page-header">
						<h3 class="text-center">Calendars</h3>
						<p class="text-center"><span class="badge">{{calendars|length}}</span></p>
					</div>
					<div class="list-group calendar-item-list">
					{% for calendar in calendars %}
						<div class="list-group-item calendar-item">
							<div class="media">
								<span class="pull-left" href="#">
									<a href="#" class='calendar-picture-link'>
										<div class="media-object img-thumbnail">
											<img src="https://s3-us-west-2.amazonaws.com/mchpstatic/Flat+Icon+SVG/SVG/calendar-blank.svg" style="width:64px">
										</div>
										<div class="assignment-number text-center text-default h4
											calendar-event-count">{{calendar.events}}</div>
									</a>
								</span>
								<div class="media-body">
									<h4 class="media-heading"><a href="" class="calendar-title">{{calendar.title}}</a>
										<small>
											<div class="pull-right small text-muted calendar-create-date">{{calendar.create_date|naturaltime}}</div>
										</small>
									</h4>
									<span class="description">
										<p class="margin-btm-none"><strong>Instructor <span
													class='calendar-professor'>{{calendar.course.professor}}</span></strong>
											<i class="fa fa-bullseye text-primary"></i>
											{% if calendar.accuracy >= 0 %}
											<span class="calendar-accuracy">{{calendar.accuracy}}</span>
											{% else %}
											<span class="calendar-accuracy">No ratings&nbsp;</span>
											{% endif %}
											{% with calendar.subscribers.count as subscribers %}
											<i class="fa fa-fw fa-users"></i><span class="calendar-subscriptions">{{subscribers}} followers&nbsp;</span></p>
										{% endwith %}
										<div class="calendar-description margin-top-none">{{calendar.description}}</div>
									</span>
								</div>
							</div>
						</div>
					{% empty %}
					<div id="no-calendars">
						<p class="lead text-center">{{user.first_name}} isn't selling any calendars!</p>
						<hr>
					</div>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
</div>
</div>
{% endblock %}
