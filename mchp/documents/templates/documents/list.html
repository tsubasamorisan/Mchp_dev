{% extends 'documents/base.html' %}

{% block extra_head %}
{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static 'documents/css/list.css' %}">
<script src="{% static 'documents/js/list.js' %}"></script>
<script src="{% static 'lib/js/jquery.cookie.js' %}"></script>		
{% endblock %}

{% block body %}
{% load humanize %}
<div class="container">
	<div class="row">
		<div class="col-xs-12">
			<div class="media">
				<img class="media-object pull-left animated slideInLeft" src="https://s3-us-west-2.amazonaws.com/mchpstatic/Flat+Icon+SVG/SVG/storage.svg" height="50px" alt="sell documents">
				<div class="media-body">
					<h2 class="media-heading">My Documents <div class='pull-right'> <a href="{%url 'document_upload'%}" class='btn btn-primary'><i class="fa fa-file fa-fw"></i> Sell Documents &raquo;</a> </div></h2>
					make money while you study</div>
			</div>
			<hr>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<ul class="nav nav-tabs h4" role="tablist">
				<li class="active">
					<a href="#selling_docs" role="tab" data-toggle="tab">
						Selling
						<span id="upload-count" class="badge">{{ upload_count }}</span></a>
				</li>
				<li>
					<a href="#purchased_docs" role="tab" data-toggle="tab">
						Purchased
						<span id="purchase-count" class="badge">{{ purchase_count}}</span></a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="selling_docs">
					<p></p>
					{% if document_list %} 
					<div class="list-group scrolls" id="document-list"> 
						{% for document in document_list %} 
						{{document.purchased_count}}
						<li class="list-group-item" id="document_{{document.pk}}"> 

							<div class="media">
								<div class="pull-left"><a href="{% url 'document_list' %}
										{{ document.uuid}}/
										{{ document.slug}}">

										{% if document.preview %}
										<img class="img-thumbnail" id="preview_image_{{document.pk}}"src="{{document.preview.url}}" style="width:64px"></a></div>
								{% else %}
								<img id="preview_image_{{document.pk}}" src="{% static 'documents/img/loading_file.svg'%}" style="width:64px"></a></div>
						{% endif %}
						<div class="media-body">
							<h4 class="media-heading">
								<div class="pull-right small text-muted">{{document.create_date | naturaltime}}</div>
								<div id="document_link_{{document.pk}}">
									{% if document.preview %}
									<a href="{% url 'document_list' %}
										{{ document.uuid}}/
										{{ document.slug}}
										">{{ document.title }}</a> 
									<small>{{document.price}} <i class="fa fa-fw fa-cube"></i></small>
									{% else %}
									<script>
										var newly_uploaded = (typeof newly_uploaded != 'undefined' && newly_uploaded instanceof Array) ? newly_uploaded : [];
										newly_uploaded.push({{document.pk}});
									</script>
									<div id="generating_message_{{document.pk}}">
										We're prepping this doc for it's big debut... <i class="fa fa-spinner fa-spin"></i>
									</div>
									{% endif %}
								</div>
							</h4>
							<small class="pull-right">
								<a href="javascript:void(0)" class="badge delete-button" data-document="{{document.pk}}">delete</a>
							</small> 

							<span class="description small">
								<div class="progress" style="width:220px; margin-bottom:2px; margin-top:6px;">
									<div class="progress-bar progress-bar-success"
										style="width:{{document.normalize_positive_votes}}%;">
									</div>
									<div class="progress-bar progress-bar-danger"
										style="width:{{document.normalize_negative_votes}}%;">
									</div>
								</div>
								<i class="fa fa-fw fa-thumbs-up text-success"></i>{{document.up}}
								<i class="fa fa-fw fa-thumbs-down text-danger"></i>{{ document.down}}&nbsp;
								{% with document.review_count as review_count %}
								<i class="fa fa-comments text-info
									fa-fw"></i>{{ review_count }}
								Review{{review_count|pluralize}}&nbsp;
								{% endwith %}
								{% with document.purchase_count as purchase_count %}
								<i class="fa fa-fw fa-money
									text-success"></i> {{purchase_count}}
								Purchase{{purchase_count|pluralize}}
								{% endwith %}
							</span> 
						</div> 
					</div> 
				</li> 
				{% endfor %} 
			</div>   
			<div id="no-documents" class="text-center" style="display: none;">
				<hr>
				<h4>You're not selling any documents!</h4>
				<a href={% url 'document_upload'%} class='btn btn-primary'><i class="fa fa-file fa-fw"></i> Sell Documents &raquo;</a>
				<hr>
			</div> 
			{% else %}
			<div id="no-documents" class="text-center">
				<hr>
				<h4>You're not selling any documents!</h4>
				<a href={% url 'document_upload'%} class='btn btn-primary'><i class="fa fa-file fa-fw"></i> Sell Documents &raquo;</a>
				<hr>
			</div>
			{% endif %} 
		</div>

		<div class="tab-pane" id="purchased_docs">
			<p></p>
			{% if purchases %}
			<div class="list-group" id="purchased_list">
				{% for document in purchases %}
				<li class="list-group-item" id="purchased_{{document.pk}}">

					<div class="media">
						<div class="img-thumbnail pull-left"><a href="{% url 'document_list' %}
								{{ document.uuid}}/
								{{ document.slug}}
								">
								{% if document.preview %}
								<img src="{{document.preview.url}}" style="width:64px"></a></div>
						{% else %}
						<img src="{% static 'documents/img/loading_file.svg'%}" style="width:64px"></a></div>
				{% endif %}

				<div class="media-body">
					<h4 class="media-heading"><a href="{% url 'document_list' %}
							{{ document.uuid}}/
							{{ document.slug}}
							">{{ document.title }}</a> <small>{{document.price}} points</small>
						<div class="pull-right small text-muted">{{document.create_date | naturaltime}}</div></h4>
					<small class="pull-right">
						<a href="javascript:void(0)" class="badge remove-button" data-document="{{document.pk}}">remove</a>
					</small>
					
					<span class="description small">
						<div class="progress progress-striped" style="width:220px; margin-bottom:2px; margin-top:6px;">
							<div class="progress-bar progress-bar-success" style="width:{{normalize_positive_votes}}%">
							</div>
							<div class="progress-bar progress-bar-danger" style="width:{{document.normalize_negative_votes}}%">
							</div>
						</div>
						<i class="fa fa-fw fa-thumbs-up text-success"></i>{{document.up}}
						<i class="fa fa-fw fa-thumbs-down text-danger"></i>{{ document.down}}&nbsp;
						<i class="fa fa-comments-o text-info fa-fw"></i>{{document.review_count}}
						Review{{document.review_count|pluralize}}&nbsp;
						<i class="fa fa-fw fa-money
							text-success"></i> {{document.purchase_count}}
						Purchase{{document.purchase_count|pluralize}}
						<p class="" style="margin-top:2px;">Uploaded by <a href="#">{{document.upload_set.get.owner.user.student.name}}</a></p>
					</span>
				</div>
			</div>
		</li>
		{% endfor %}
	</div>
	<div id="no-purchases" class="text-center" style="display: none">
		<hr>
		<h4>You haven't purchased any documents!</h4>
		<a href={% url 'document_list'%} class='btn btn-primary'><i class="fa fa-file fa-fw"></i> Browse Documents &raquo;</a>
		<hr>
	</div>
	{% else %}
	<div id="no-purchases" class="text-center">
		<hr>
		<h4>You haven't purchased any documents!</h4>
		<a href={% url 'document_list'%} class='btn btn-primary'><i class="fa fa-file fa-fw"></i> Browse Documents &raquo;</a>
		<hr>
	</div>
	{% endif %}
</div>
			</div>		
		</div>
	</div>
</div>	
{% endblock %}
